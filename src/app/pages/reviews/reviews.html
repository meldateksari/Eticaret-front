<div class="relative flex min-h-screen flex-col bg-[#fbf9f9] overflow-x-hidden"
     style="font-family: 'Plus Jakarta Sans','Noto Sans',sans-serif">
  <div class="mx-auto w-full max-w-[960px] px-6 py-8">

    <!-- === Başlık ve genel özet === -->
    <h2 class="text-2xl font-bold text-[#191010]">Customer Reviews</h2>

    <div class="mt-6 flex flex-wrap gap-x-8 gap-y-6">

      <!-- Ortalama puan -->
      <div class="flex flex-col gap-2">
        <p class="text-4xl font-black tracking-tight text-[#191010]">
          {{ averageRating() }}
        </p>

        <div class="flex gap-0.5">
          <ng-container *ngFor="let filled of starsArray(averageRating())">
            <svg width="18" height="18" viewBox="0 0 256 256"
                 [ngClass]="filled ? 'text-[#e8b5b7]' : 'text-[#e3d4d4]'" fill="currentColor">
              <path
                d="M234.5,114.38l-45.1,39.36,13.51,58.6a16,16,0,0,1-23.84,17.34l-51.11-31-51,31a16,16,0,0,1-23.84-17.34L66.61,153.8,21.5,114.38a16,16,0,0,1,9.11-28.06l59.46-5.15,23.21-55.36a15.95,15.95,0,0,1,29.44,0h0L166,81.17l59.44,5.15a16,16,0,0,1,9.11,28.06Z" />
            </svg>
          </ng-container>
        </div>

        <p class="text-base text-[#191010]">{{ reviews.length }} reviews</p>
      </div>

      <!-- Puan dağılımı -->
      <div class="grid min-w-[200px] max-w-[400px] flex-1 grid-cols-[20px_1fr_40px] items-center gap-y-3">
        <ng-container *ngFor="let r of ratingValues">
          <p class="text-sm text-[#191010]">{{ r }}</p>
          <div class="flex h-2 flex-1 overflow-hidden rounded-full bg-[#e3d4d4]">
            <div class="rounded-full bg-[#e8b5b7]" [style.width.%]="ratingPercent(r)"></div>
          </div>
          <p class="text-right text-sm text-[#8b5b5c]">{{ ratingPercent(r) }}%</p>
        </ng-container>
      </div>
    </div>

    <!-- === Mevcut yorumlar === -->
    <h3 class="mt-8 text-lg font-bold text-[#191010]">Existing Reviews</h3>

    <div class="mt-4 flex flex-col gap-8">
      <ng-container *ngFor="let rev of reviews; trackBy: trackById">
        <div class="flex flex-col gap-3">
          <div class="flex items-center gap-3">
            <div class="size-10 rounded-full bg-cover bg-center"></div>

            <div class="flex-1">
              <p class="text-base font-medium text-[#191010]">User ID: {{ rev.userId }}</p>
              <p class="text-sm text-[#8b5b5c]">{{ rev.createdAt  }}</p>
            </div>

            <button *ngIf="rev.userId === currentUserId" (click)="deleteReview(rev.id)"
                    class="text-sm text-[#8b5b5c] hover:underline" title="Delete">
              Delete
            </button>
          </div>

          <div class="flex gap-0.5">
            <ng-container *ngFor="let filled of starsArray(rev.rating)">
              <svg width="20" height="20" viewBox="0 0 256 256"
                   [ngClass]="filled ? 'text-[#e8b5b7]' : 'text-[#cfb5b6]'" fill="currentColor">
                <path
                  d="M234.5,114.38l-45.1,39.36,13.51,58.6a16,16,0,0,1-23.84,17.34l-51.11-31-51,31a16,16,0,0,1-23.84-17.34L66.61,153.8,21.5,114.38a16,16,0,0,1,9.11-28.06l59.46-5.15,23.21-55.36a15.95,15.95,0,0,1,29.44,0h0L166,81.17l59.44,5.15a16,16,0,0,1,9.11,28.06Z" />
              </svg>
            </ng-container>
          </div>

          <p class="text-base text-[#191010]">{{ rev.comment }}</p>
        </div>
      </ng-container>

      <p *ngIf="!reviews.length" class="text-[#8b5b5c]">Henüz yorum yok.</p>
    </div>

    <!-- === Yorum gönderme formu === -->
    <h3 class="mt-8 text-lg font-bold text-[#191010]">Submit Your Review</h3>

    <div class="mt-3 flex max-w-[480px] flex-wrap items-end gap-4">
      <label class="flex flex-1 flex-col">
        <span class="pb-2 text-base font-medium text-[#191010]">Rating</span>
        <select class="h-14 w-full rounded-xl border border-[#e3d4d4] bg-[#fbf9f9] p-3 text-base text-[#191010]"
                [(ngModel)]="newRating">
          <option *ngFor="let r of [5,4,3,2,1]" [value]="r">{{ r }}</option>
        </select>
      </label>
    </div>

    <div class="mt-3 flex max-w-[480px] flex-wrap items-end gap-4">
      <label class="flex flex-1 flex-col">
        <span class="pb-2 text-base font-medium text-[#191010]">Comment</span>
        <textarea class="min-h-36 w-full resize-none rounded-xl border border-[#e3d4d4] bg-[#fbf9f9] p-3 text-base text-[#191010]"
                  placeholder="Write your review here" [(ngModel)]="newComment"></textarea>
      </label>
    </div>

    <div class="mt-3 flex justify-end max-w-[480px]">
      <button class="h-10 min-w-[84px] rounded-full bg-[#e8b5b7] px-4 text-sm font-bold text-[#191010]"
              (click)="submitReview()" [disabled]="!newComment.trim()">
        Submit Review
      </button>
    </div>
  </div>
</div>
